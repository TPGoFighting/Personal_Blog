{% extends 'blog/base.html' %}
{% load markdown_extras %} {% block title %}
  {{ post.title }}
{% endblock %}

{% block content %}
  <style>
    /* 1. 初始状态：标准阅读模式 */
    #main-column {
      transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
      margin: 0 auto;
      width: 100%;
    }
    
    .view-mode-standard {
      max-width: 1050px !important;
    }
    
    /* 宽屏显示模式 */
    .view-mode-wide {
      max-width: 75vw !important;
      width: 75vw !important;
    }
    
    /* 宽屏模式下正文字号微调 */
    .view-mode-wide .post-content {
      font-size: 1.2rem;
    }
    
    /* 3. 功能工具栏样式 */
    .function-toolbar {
      background: #ffffff;
      padding: 16px 24px;
      border-radius: 16px;
      border: 1px solid #e1e9f4;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      margin-bottom: 2rem;
      /* 新增：移动端按钮自动换行，防止挤叠 */
      flex-wrap: wrap;
      gap: 12px !important;
    }
    
    /* 4. 正文样式 */
    .post-content {
      font-size: 1.1rem;
      line-height: 1.85;
      color: #2c3e50;
    }
    
    /* 适配：防止代码块和图片在分栏处断开 + 移动端溢出优化 */
    .post-content pre,
    .post-content img,
    .post-content blockquote {
      break-inside: avoid;
      max-width: 100%;
      margin-bottom: 1.5rem;
    }
    /* 新增：代码块移动端横向滚动，避免溢出 */
    .post-content pre {
      overflow-x: auto;
      padding: 1rem;
      border-radius: 8px;
    }
    /* 新增：图片移动端自适应，防止拉伸 */
    .post-content img {
      object-fit: contain;
    }
    
    /* 按钮微调：让操作更显眼 + 触控友好基础样式 */
    .btn-manage,
    .function-toolbar .btn {
      font-weight: 500;
      letter-spacing: 0.5px;
      /* 新增：最小点击区域，防止误触 */
      min-width: 80px;
      text-align: center;
    }
    
    /* ========== 核心：移动端媒体查询（768px以下小屏）========== */
    @media (max-width: 768px) {
      /* 1. 移动端强制标准模式，禁用宽屏（小屏无需宽屏） */
      #main-column {
        max-width: 92vw !important;
        width: 92vw !important;
      }
      /* 2. 移动端页面整体留白，避免贴边 */
      body {
        padding-left: 8px !important;
        padding-right: 8px !important;
      }
      /* 3. 工具栏适配：缩小内边距，调整排版 */
      .function-toolbar {
        padding: 12px 16px;
        margin-bottom: 1.2rem;
      }
      /* 4. 标题字号：移动端缩小，避免过大 */
      .post-content h1 {
        font-size: 1.8rem;
      }
      .post-content h2 {
        font-size: 1.6rem;
      }
      .post-content h3 {
        font-size: 1.4rem;
      }
      .card-body h1 {
        font-size: 1.8rem !important;
      }
      /* 5. 正文字号：移动端调小，提升阅读体验 */
      .post-content {
        font-size: 1rem !important;
        line-height: 1.8;
      }
      /* 6. 卡片内边距：移动端缩小，节省空间 */
      .card-body {
        padding: 24px 20px !important;
      }
      /* 7. 按钮优化：移动端加大触控区域，适配手指点击 */
      .function-toolbar .btn {
        padding: 6px 12px !important;
        font-size: 0.85rem !important;
        min-width: 70px;
      }
      /* 8. 编辑/删除按钮：移动端自适应宽度，避免换行后太挤 */
      .function-toolbar .btn-manage {
        min-width: 90px;
      }
      /* 9. 隐藏移动端无用元素：模式切换按钮（小屏无需标准/宽屏切换） */
      .function-toolbar .btn-group {
        display: none !important;
      }
    }
    
    /* 小屏平板适配（768px-992px）：轻度调整 */
    @media (min-width: 769px) and (max-width: 992px) {
      .view-mode-standard {
        max-width: 90vw !important;
      }
      .post-content {
        font-size: 1.05rem;
      }
    }
  </style>

  <div class="row justify-content-center mt-4">
    <div id="main-column" class="view-mode-standard">
      <div class="function-toolbar d-flex justify-content-between align-items-center">
        <div class="d-flex gap-2">
          <a href="{% url 'home' %}" class="btn btn-sm btn-outline-dark rounded-pill px-3"><i class="bi bi-house"></i> 首页</a>
          <div class="btn-group shadow-sm ms-2" role="group">
            <button id="btn-standard" class="btn btn-sm btn-dark active">标准模式</button>
            <button id="btn-wide" class="btn btn-sm btn-outline-dark">宽屏显示</button>
          </div>
        </div>

        <div class="d-flex gap-2">
          <a href="{% url 'post-update' post.pk %}?next={{ request.get_full_path }}" class="btn btn-sm btn-primary btn-manage rounded-pill px-4 shadow-sm"><i class="bi bi-pencil-square"></i> 编辑</a>
          <a href="{% url 'post-delete' post.pk %}?next={{ request.get_full_path }}" class="btn btn-sm btn-outline-danger rounded-pill px-3"><i class="bi bi-trash"></i> 删除文章</a>
        </div>
      </div>

      <div class="card shadow-sm border-0 rounded-4 overflow-hidden">
        <div class="card-body p-4 p-md-5">
          <header class="mb-4">
            <h1 class="fw-bold mb-3" style="color: #1a202c; font-size: 2.2rem;">{{ post.title }}</h1>
            <div class="d-flex align-items-center text-muted small">
              <span class="me-3"><i class="bi bi-person-circle"></i> {{ post.author }}</span>
              <span><i class="bi bi-calendar3"></i> {{ post.beijing_created_at|date:'Y年m月d日 H:i' }}</span>
            </div>
          </header>

          <hr class="mb-5" style="opacity: 0.08;" />

          <div id="readable-content" class="post-content">{{ post.content|markdown }}</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const content = document.getElementById('readable-content')
    const mainColumn = document.getElementById('main-column')
    const btnStandard = document.getElementById('btn-standard')
    const btnWide = document.getElementById('btn-wide')
    
    // 切换到宽屏显示模式
    btnWide.addEventListener('click', () => {
      mainColumn.classList.remove('view-mode-standard')
      mainColumn.classList.add('view-mode-wide')
      // 按钮状态切换
      btnWide.classList.replace('btn-outline-dark', 'btn-dark')
      btnWide.classList.add('active')
      btnStandard.classList.replace('btn-dark', 'btn-outline-dark')
      btnStandard.classList.remove('active')
    })
    
    // 切换到标准模式
    btnStandard.addEventListener('click', () => {
      mainColumn.classList.remove('view-mode-wide')
      mainColumn.classList.add('view-mode-standard')
      // 按钮状态切换
      btnStandard.classList.replace('btn-outline-dark', 'btn-dark')
      btnStandard.classList.add('active')
      btnWide.classList.replace('btn-dark', 'btn-outline-dark')
      btnWide.classList.remove('active')
    })
    
    // 新增：移动端窗口大小变化时，强制切回标准模式（防止横屏误触）
    window.addEventListener('resize', () => {
      if (window.innerWidth <= 768) {
        mainColumn.classList.remove('view-mode-wide')
        mainColumn.classList.add('view-mode-standard')
      }
    })
  </script>
{% endblock %}
